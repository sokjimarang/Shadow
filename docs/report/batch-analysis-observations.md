# 배치 분석 vs 개별 분석: 관찰 리포트

**작성일: 2026-02-01**
**상태: 테스트 완료, 배치 모드 적용됨**

---

## 1. 배경

키프레임 분석 비용 최적화를 위해 배치 분석 방식을 테스트했다.
- **개별 분석**: 키프레임 1쌍당 API 호출 1회
- **배치 분석**: 키프레임 N쌍을 묶어서 API 호출 1회

## 2. 테스트 조건

### 2.1 테스트 이미지 (합성)
- 200x150px 단순 이미지
- 배치 크기: 1, 2, 5, 10
- 결과: 모든 배치 크기에서 정확도 100%, 비용 55% 절감

### 2.2 실제 스크린샷 (정적)
- 1024x662px (리사이즈됨)
- 20쌍 캡처 (0.3초 간격)
- **조건**: 캡처 중 실제 클릭 동작 없음 (화면 변화 없음)

### 2.3 실제 스크린샷 (동적) ✅
- 1024x662px (리사이즈됨)
- 20쌍 캡처 (0.75초 간격, 15초간)
- **조건**: 캡처 중 실제 동작 수행 (칸반 드래그, 스크롤, 앱 전환, 테스트 실행 등)

## 3. 발견된 현상

### 3.1 개별 분석 (batch_size=1)의 환각

변화가 없는 스크린샷임에도 불구하고, 개별 분석 시 다음과 같이 응답:

```
"터미널 입력창에 커서가 활성화되어 명령어 입력 대기 상태가 되었습니다"
"화면에 시각적 변화가 없어 보이지만, 새 페이지 생성 프로세스가 진행 중이거나 완료되었을 가능성이 있습니다"
```

**특징**: 실제로는 화면 변화가 없었음. 모델이 "뭔가 변했을 것"이라고 추측/환각함.

### 3.2 배치 분석 (batch_size=5~20)의 정직한 응답

동일한 스크린샷에 대해 배치 분석 시:

```
"no visible change - none detected"
"no_change - 전체 보드 (상태 변화 없음)"
```

**특징**: 변화가 없음을 정직하게 인정함.

### 3.3 실제 동작 감지 (동적 테스트)

| 동작 유형 | batch=1 | batch=5 | batch=10 | batch=20 |
|----------|---------|---------|----------|----------|
| 드래그 (칸반 이동) | ✅ | ✅ | ✅ | ✅ |
| 스크롤 | ✅ | ✅ | ✅ | ✅ |
| 앱 전환 | ✅ | ✅ | ✅ | ✅ |
| 테스트 실행 | ✅ | ✅ | ✅ | ✅ |
| 변화 없음 감지 | ❌ (환각) | ✅ | ⚠️ | ✅ |

**결론**: 실제 동작은 모든 배치 크기에서 정확히 감지. 환각은 개별 분석에서 더 많이 발생.

## 4. 가설

### 가설 A: Attention 집중도 차이
- **개별 분석**: 이미지 1쌍에만 집중 → "뭔가 찾아야 한다"는 압박 → 미세한 차이 과대 해석
- **배치 분석**: 여러 쌍에 attention 분산 → 미세한 차이 무시

### 가설 B: 비교 기준의 차이
- **개별 분석**: Before/After 2장만 비교 → 상대적 기준 없음
- **배치 분석**: 여러 쌍을 동시에 비교 → "다 비슷하네 → 변화 없음" 패턴 인식

### 가설 C: 프롬프트 압박
- **개별 분석**: "이 클릭으로 뭐가 변했나요?"라는 프롬프트에 답해야 함 → 환각 유발
- **배치 분석**: 여러 쌍 중 변화 없는 것은 건너뛸 수 있음

## 5. 비용/시간 비교 (실제 스크린샷 20쌍 기준)

| 배치 크기 | API 호출 | 비용 | 시간 | 비용 절감 | 시간 단축 |
|----------|---------|------|------|----------|----------|
| 1 (개별) | 20회 | $0.182 | 103초 | - | - |
| 5 | 4회 | $0.141 | 44초 | 22% | 57% |
| **10** | **2회** | **$0.131** | **34초** | **28%** | **67%** |
| 20 | 1회 | $0.142 | 34초 | 22% | 67% |

**주목**: batch_size=10이 비용 최적 (출력 토큰 효율)

## 6. 최종 결론

### 권장 배치 크기: 5~10

| 항목 | 개별 분석 (1) | 배치 분석 (5~10) |
|------|--------------|-----------------|
| 비용 | 높음 (기준) | **22~28% 절감** |
| 시간 | 느림 (기준) | **57~67% 단축** |
| 환각 위험 | 높음 | **낮음** |
| 실제 동작 감지 | 100% | **100%** |

### 적용 사항

- `ClaudeAnalyzer`에 배치 모드 추가 (기본값: batch_size=5)
- 개별 분석 모드도 유지 (호환성)

---

## 변경 이력

| 날짜 | 변경 내용 |
|------|----------|
| 2026-02-01 | 초기 관찰 문서 작성 |
| 2026-02-01 | 실제 동작 테스트 결과 추가, 배치 모드 적용 결정 |
